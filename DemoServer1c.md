

# Пример конфигурации 1С v7.7 для работы с DroidPres #

Вы можете [скачать](http://code.google.com/p/droidpres/downloads/detail?name=1C_DroidPres.7z) с данного сайта простой пример конфигурации 1С v7.7 для обмена данными и учета заказов. В данной конфигурации для обмена данных используется выше указанный [сервер](http://code.google.com/p/droidpres/downloads/detail?name=droidpresd.tar.bz2). В архиве с конфигурацией есть модуль прослойка (proxy) "proxy\_demo\_1c.py".

Для работы Вам потребуется:

  * [1С Предприятие v7.7](http://ru.wikipedia.org/wiki/1%D0%A1:%D0%9F%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B5#.D0.92.D0.B5.D1.80.D1.81.D0.B8.D1.8F_7..D1.85_.287.0.2C_7.5.2C_7.7.29)
  * Высокоуровневый язык программирования [Python](http://www.python.org/)
  * Поскольку взаимодействие сервера и 1С реализовано посредством механизма [OLE Automation](http://ru.wikipedia.org/wiki/OLE). Вам потребуется библиотека [Python for Windows Extensions](http://pywin32.sourceforge.net)


Установка

Устанавливаем Python, библиотеку pywin32, 1С. Распаковываем 1C\_DroidPres.7z и указываем его в настройках 1С. Распаковываем droidpresd.tar.bz2 результат:

```
.settings\
doc\
src\
.project
.pydevproject
```
Весь программный код находиться в папке "src":
```
apk\
db\
lib\
proxy_mod\
cfg.py
droidpresd.py
```

  * **apk** - В каталоге находятся файлы необходимые для обновления версий ПО на мобильных устройствах. В частности (DroidPres.apk) самая свежая версия DroidPres. (aapt.exe - win32, aapt - linux x86) утилита из [Android SDK](http://developer.android.com/sdk/index.html) для работы с apk файлами, требуется для определения версии (DroidPres.apk). При этом замену (DroidPres.apk) на новую версию можно проводить так сказать на "горячую" без остановки сервера. Клиентская часть при обновлении данных получит самую свежую версию DroidPres, и предложить обновиться.
  * **db** - В каталоге находятся файл базы данных SQLite который использует прокси модуль (proxy\_demo\_sqlite.py)
  * **lib** - программный код XML-RPC сервера.
  * **proxy\_mod** - В каталоге находятся прокси модули для взаимодействия с разными базами данных (систем учета)
  * **cfg.py** - Модуль конфигурации
  * **droidpresd.py** - Модуль запуска сервера.

## Настройка ##

Для настройки сервера надо отредактировать файл cfg.py. Все параметры можно оставить по умолчанию и указать только PROXY\_MODULE = 'proxy\_demo\_1c'. В файле proxy\_mod/proxy\_demo\_1c.py также надо будет внести изменения:

  * DB\_PATH - Путь куда Вы распаковали конфигурацию 1С
  * V7\_APPLICATION - Версия вашей 1С7.7
    * V77.Application — версия зависимый ключ;
    * V77S.Application — версия зависимый ключ, SQL версия;
    * V77L.Application — версия зависимый ключ, локальная версия;
    * V77M.Application — версия зависимый ключ, сетевая версия.

## Запуск ##

После установки и настройки можно запустить сервер droidpresd.py. 1С для работы сервера запускать не надо, обмен данными осуществляется посредством OLE.

Итог: Почему то 1С7.7 не совсем полностью захотела работать через OLE с Python, в частности я не смог получить прямой доступ к справочникам, а к документам даже и не пытался. Поэтому в реализации пришлось пойти на некоторые ухищрения, которые вы сможете увидеть в исходном коде. Но на работоспособность, скорость, стабильность это не как не отразиться.

Хочу заметить не обязательно использовать сервер который выложен здесь как пример. Вы можете реализовать его в любом удобном для вас виде. Главное чтобы он соответствовал Техническим требованиям.

Посмотреть как это работает:

<a href='http://www.youtube.com/watch?feature=player_embedded&v=z4utZSU1raI' target='_blank'><img src='http://img.youtube.com/vi/z4utZSU1raI/0.jpg' width='425' height=344 /></a>